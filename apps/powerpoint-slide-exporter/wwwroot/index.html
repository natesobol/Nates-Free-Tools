<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PowerPoint Slide Exporter | Monetize Hub Tools</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="../../../public/css/webapp-theme.css" />
  </head>
  <body>
    <div class="app-shell">
      <header class="d-flex align-items-center justify-content-between mb-4">
        <div>
          <span class="pill">PPTX → PNG &amp; HTML snippets</span>
          <h1 class="h2 mt-3 mb-1">PowerPoint Slide Exporter</h1>
          <p class="muted mb-0">Turn every slide into ready-to-share assets for archiving, blogging, or embedding.</p>
        </div>
        <img
          src="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/1f4be.svg"
          width="60"
          height="60"
          alt="Save icon"
        />
      </header>

      <div class="card-gradient mb-4">
        <form id="exportForm" novalidate>
          <div class="mb-3 dropzone" id="dropzone">
            <label for="pptFile" class="form-label fw-semibold">Choose a PowerPoint file</label>
            <input class="form-control" type="file" id="pptFile" accept=".ppt,.pptx" required />
            <div class="form-text text-light">Files are processed in-memory; nothing is stored server-side.</div>
          </div>

          <div class="options-grid">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="mode" id="modeImages" value="images" checked />
              <label class="form-check-label" for="modeImages">
                Export slide images (PNG)
                <span class="d-block small muted">Best for quick previews or uploading to CMS tools.</span>
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="mode" id="modeHtml" value="html" />
              <label class="form-check-label" for="modeHtml">
                Export HTML snippets
                <span class="d-block small muted">Pull text, layout, and assets into shareable HTML.</span>
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="mode" id="modeBoth" value="both" />
              <label class="form-check-label" for="modeBoth">
                Export both formats
                <span class="d-block small muted">Get a single zip containing PNGs and HTML output.</span>
              </label>
            </div>
          </div>

          <div class="d-flex flex-wrap gap-2 align-items-center mt-3">
            <button type="submit" class="btn btn-primary" id="exportBtn">Export slides</button>
            <span class="muted small">Requires LibreOffice on the host machine.</span>
          </div>
        </form>
        <div class="status" id="status" role="status" aria-live="polite" style="margin-top: 1rem"></div>
      </div>

      <div class="options-grid">
        <div class="meta-card">
          <strong>All slides, one zip</strong><br />Download PNGs, HTML, and supporting assets together with clean filenames.
        </div>
        <div class="meta-card">
          <strong>Error-aware</strong><br />If LibreOffice is missing, you’ll see a friendly hint instead of a broken download.
        </div>
        <div class="meta-card">
          <strong>Local-friendly</strong><br />Run the .NET app locally to keep presentations on your own machine.
        </div>
      </div>
    </div>

    <script>
      const form = document.getElementById('exportForm');
      const fileInput = document.getElementById('pptFile');
      const statusEl = document.getElementById('status');
      const exportBtn = document.getElementById('exportBtn');
      const dropzone = document.getElementById('dropzone');

      const setStatus = (type, message) => {
        const variant = type === 'success' ? 'success' : type === 'warning' ? 'warning' : 'danger';
        statusEl.innerHTML = `<div class="alert alert-${variant} mb-0">${message}</div>`;
      };

      const clearStatus = () => (statusEl.innerHTML = '');

      const downloadFile = (blob, filename) => {
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        a.click();
        URL.revokeObjectURL(url);
      };

      const handleDrop = (event) => {
        event.preventDefault();
        dropzone.classList.remove('dragover');
        if (event.dataTransfer.files?.length) {
          fileInput.files = event.dataTransfer.files;
        }
      };

      dropzone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropzone.classList.add('dragover');
      });
      dropzone.addEventListener('dragleave', () => dropzone.classList.remove('dragover'));
      dropzone.addEventListener('drop', handleDrop);

      form.addEventListener('submit', async (event) => {
        event.preventDefault();
        clearStatus();

        const file = fileInput.files?.[0];
        if (!file) {
          setStatus('error', 'Pick a PowerPoint file first.');
          return;
        }

        if (!/\.pptx?$/i.test(file.name)) {
          setStatus('error', 'Only .ppt and .pptx files are supported.');
          return;
        }

        const mode = form.mode.value;

        exportBtn.disabled = true;
        exportBtn.textContent = 'Exporting…';
        setStatus('warning', 'Working… This requires LibreOffice when running locally.');

        const formData = new FormData();
        formData.append('file', file);
        formData.append('mode', mode);

        try {
          const response = await fetch('/api/export', { method: 'POST', body: formData });
          if (!response.ok) {
            let message = 'Export failed.';
            try {
              const payload = await response.json();
              if (payload?.error) message = payload.error;
            } catch (_) {
              // ignore parse errors
            }
            throw new Error(message);
          }

          const blob = await response.blob();
          downloadFile(blob, file.name.replace(/\.[^.]+$/, '') + '-slides.zip');
          setStatus('success', 'Success! Your download should begin automatically.');
        } catch (error) {
          const advisory =
            error.message?.toLowerCase().includes('libreoffice') || error.message?.toLowerCase().includes('soffice')
              ? ' Install LibreOffice (soffice) and try again.'
              : ' If you are viewing the static demo, run the .NET app locally to enable conversion.';
          setStatus('error', `${error.message}${advisory}`);
        } finally {
          exportBtn.disabled = false;
          exportBtn.textContent = 'Export slides';
        }
      });
    </script>
  </body>
</html>
