<!DOCTYPE html>
<html lang="en">
<head>
    <script id="asset-base-loader">
      (function() {
        const segments = window.location.pathname.split('/').filter(Boolean);
        const repoIndex = segments.indexOf('Nates-Free-Tools');
        const baseHref = repoIndex !== -1 ? '/' + segments.slice(0, repoIndex + 1).join('/') + '/' : '/';
        let baseTag = document.querySelector('base');
        if (!baseTag) {
          baseTag = document.createElement('base');
          document.head.prepend(baseTag);
        }
        baseTag.href = baseHref;
      })();
    </script>

    <link rel="stylesheet" href="css/webapps-unified.css" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Extract Image Paths from HTML, Markdown, and TXT</title>

  <style>
    :root {
      color-scheme: light dark;
      --bg: #0b1224;
      --card: #0f172a;
      --border: #1f2937;
      --muted: #94a3b8;
      --accent: #38bdf8;
      --accent-strong: #0ea5e9;
      --text: #e2e8f0;
      --shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: radial-gradient(circle at 20% 20%, rgba(56, 189, 248, 0.12), transparent 25%),
        radial-gradient(circle at 80% 0%, rgba(14, 165, 233, 0.1), transparent 22%),
        var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 32px 16px 64px;
    }

    header {
      max-width: 1100px;
      margin: 0 auto 28px;
      text-align: center;
    }

    h1 {
      margin: 0;
      font-size: clamp(28px, 4vw, 42px);
      letter-spacing: -0.02em;
    }

    p.lede {
      color: var(--muted);
      margin: 10px 0 0;
      font-size: 17px;
    }

    main {
      max-width: 1100px;
      margin: 0 auto;
      display: grid;
      gap: 20px;
    }

    .card {
      background: rgba(15, 23, 42, 0.88);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }

    .stack {
      display: grid;
      gap: 12px;
    }

    .actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
    }

    .button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 14px;
      background: linear-gradient(135deg, var(--accent), var(--accent-strong));
      border: none;
      border-radius: 12px;
      color: #0b1224;
      font-weight: 700;
      cursor: pointer;
      text-decoration: none;
      transition: transform 120ms ease, box-shadow 120ms ease;
    }

    .button.secondary {
      background: rgba(148, 163, 184, 0.14);
      color: var(--text);
      border: 1px solid var(--border);
    }

    .button:active {
      transform: translateY(1px);
    }

    .button input {
      display: none;
    }

    .dropzone {
      border: 1.5px dashed rgba(148, 163, 184, 0.35);
      border-radius: 14px;
      padding: 18px;
      text-align: center;
      color: var(--muted);
      background: rgba(148, 163, 184, 0.06);
      transition: border-color 120ms ease, background 120ms ease;
    }

    .dropzone.dragover {
      border-color: var(--accent);
      background: rgba(56, 189, 248, 0.08);
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: rgba(148, 163, 184, 0.12);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      font-size: 14px;
    }

    .muted {
      color: var(--muted);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
      font-size: 14px;
    }

    th, td {
      text-align: left;
      padding: 10px 8px;
      border-bottom: 1px solid var(--border);
    }

    th {
      color: var(--muted);
      font-weight: 600;
    }

    .path {
      color: var(--accent);
      word-break: break-all;
    }

    .controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 10px;
      background: rgba(56, 189, 248, 0.12);
      color: var(--accent);
      border-radius: 10px;
      border: 1px solid rgba(56, 189, 248, 0.3);
      font-weight: 600;
      font-size: 13px;
    }

    @media (max-width: 640px) {
      .controls {
        flex-direction: column;
        align-items: stretch;
      }

      .actions {
        flex-direction: column;
        align-items: stretch;
      }
    }
  </style>
  <script src="js/site-chrome.js" defer></script>
</head>
<body>
  <header>
    <p class="badge">üîç Asset audit helper</p>
    <h1>Extract image paths from HTML, Markdown, and text files.</h1>
    <p class="lede">Drag in your docs and get a clean list of every image reference‚Äîcomplete with source file, syntax type, and line number.</p>
  </header>

  <main>
    <section class="card stack">
      <div class="controls">
        <div class="actions">
          <label class="button" for="fileInput">
            <input id="fileInput" type="file" accept=".html,.htm,.md,.markdown,.txt" multiple />
            <span>Choose files</span>
          </label>
          <button class="button secondary" id="clearButton" type="button">Clear results</button>
        </div>
        <div class="pill">Supports .html, .md, and .txt uploads</div>
      </div>
      <div class="dropzone" id="dropzone">
        <strong>Drop files here</strong>
        <div class="muted">We scan HTML <code>&lt;img src="‚Ä¶"&gt;</code>, Markdown images, and plain text paths (png, jpg, svg, webp, gif, bmp, tiff, ico, avif).</div>
      </div>
    </section>

    <section class="card stack">
      <div class="controls">
        <div>
          <h3 style="margin: 0">Results</h3>
          <p class="muted" id="summary" style="margin: 4px 0 0;">No files processed yet.</p>
        </div>
        <div class="actions">
          <button class="button secondary" id="copyButton" type="button" disabled>Copy CSV</button>
        </div>
      </div>
      <div id="resultsContainer">
        <p class="muted">Upload or drop files to see extracted image paths.</p>
      </div>
    </section>
  </main>

  <script>
    const dropzone = document.getElementById('dropzone');
    const fileInput = document.getElementById('fileInput');
    const summary = document.getElementById('summary');
    const resultsContainer = document.getElementById('resultsContainer');
    const copyButton = document.getElementById('copyButton');
    const clearButton = document.getElementById('clearButton');

    let results = [];

    function formatResultsTable(rows, errors = []) {
      const hasRows = rows.length > 0;
      const hasErrors = errors.length > 0;

      if (!hasRows && !hasErrors) {
        resultsContainer.innerHTML = '<p class="muted">Upload or drop files to see extracted image paths.</p>';
        copyButton.disabled = true;
        return;
      }

      const errorList = hasErrors
        ? `<div class="pill" style="background: rgba(248, 113, 113, 0.12); color: #fecdd3; border-color: rgba(248, 113, 113, 0.4);">${errors
            .map(e => escapeHtml(e))
            .join('<br />')}</div>`
        : '';

      const tableRows = hasRows
        ? rows
            .map(r => `
              <tr>
                <td class="path">${escapeHtml(r.path)}</td>
                <td>${escapeHtml(r.source)}</td>
                <td>${escapeHtml(r.kind)}</td>
                <td>${r.line}</td>
              </tr>
            `)
            .join('')
        : '';

      resultsContainer.innerHTML = `
        <div class="stack">
          ${errorList}
          ${hasRows
            ? `<div style="overflow-x: auto;">
                <table>
                  <thead>
                    <tr>
                      <th>Image path</th>
                      <th>Source file</th>
                      <th>Found as</th>
                      <th>Line</th>
                    </tr>
                  </thead>
                  <tbody>${tableRows}</tbody>
                </table>
              </div>`
            : !hasErrors
              ? '<p class="muted">No image references were found in the uploaded files.</p>'
              : ''}
        </div>`;

      copyButton.disabled = !hasRows;
    }

    function escapeHtml(str) {
      return str.replace(/[&<>"']/g, char => ({
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#39;'
      }[char] || char));
    }

    function updateSummary(totalMatches, filesProcessed) {
      if (!filesProcessed) {
        summary.textContent = 'No files processed yet.';
        return;
      }

      const matchesLabel = totalMatches === 1 ? 'reference' : 'references';
      const filesLabel = filesProcessed === 1 ? 'file' : 'files';
      summary.textContent = `${totalMatches} image ${matchesLabel} found across ${filesProcessed} ${filesLabel}.`;
    }

    async function handleFiles(fileList) {
      const files = Array.from(fileList).filter(file => /\.(html?|md|markdown|txt)$/i.test(file.name));
      if (!files.length) {
        return;
      }

      const formData = new FormData();
      files.forEach(file => formData.append('files', file));

      summary.textContent = 'Scanning files...';
      resultsContainer.innerHTML = '<p class="muted">Processing uploads...</p>';
      copyButton.disabled = true;

      try {
        const response = await fetch('/api/extract', {
          method: 'POST',
          body: formData
        });

        const payload = await response.json();

        if (!response.ok) {
          throw new Error(payload.error || 'Failed to process files.');
        }

        const errors = [];
        results = [];

        (payload.results || []).forEach(file => {
          if (file.error) {
            errors.push(`${file.source}: ${file.error}`);
            return;
          }

          (file.matches || []).forEach(match => {
            results.push({
              path: match.path,
              source: file.source,
              kind: match.syntax,
              line: match.line
            });
          });
        });

        results.sort((a, b) => a.source.localeCompare(b.source) || a.line - b.line || a.path.localeCompare(b.path));

        updateSummary(payload.totalMatches || 0, payload.filesProcessed || files.length);
        formatResultsTable(results, errors);
      } catch (error) {
        summary.textContent = 'Something went wrong.';
        resultsContainer.innerHTML = `<p class="muted">${escapeHtml(error.message)}</p>`;
      }
    }

    dropzone.addEventListener('dragover', event => {
      event.preventDefault();
      dropzone.classList.add('dragover');
    });

    dropzone.addEventListener('dragleave', () => {
      dropzone.classList.remove('dragover');
    });

    dropzone.addEventListener('drop', event => {
      event.preventDefault();
      dropzone.classList.remove('dragover');
      handleFiles(event.dataTransfer.files);
    });

    fileInput.addEventListener('change', event => handleFiles(event.target.files));

    copyButton.addEventListener('click', () => {
      if (!results.length) return;
      const header = 'image_path,source_file,found_as,line';
      const csv = results
        .map(r => [r.path, r.source, r.kind, r.line]
          .map(value => `"${String(value).replace(/"/g, '""')}"`).join(','))
        .join('\n');
      navigator.clipboard.writeText(`${header}\n${csv}`);
      copyButton.textContent = 'Copied!';
      setTimeout(() => (copyButton.textContent = 'Copy CSV'), 1400);
    });

    clearButton.addEventListener('click', () => {
      results = [];
      fileInput.value = '';
      formatResultsTable(results);
      summary.textContent = 'No files processed yet.';
      copyButton.textContent = 'Copy CSV';
    });
  </script>
</body>
</html>
