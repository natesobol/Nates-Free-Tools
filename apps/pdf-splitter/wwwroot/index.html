<!DOCTYPE html>
<html lang="en">
  <head>
    <script id="asset-base-loader">
      (function() {
        const segments = window.location.pathname.split('/').filter(Boolean);
        const repoIndex = segments.indexOf('Nates-Free-Tools');
        const baseHref = repoIndex !== -1 ? '/' + segments.slice(0, repoIndex + 1).join('/') + '/' : '/';
        let baseTag = document.querySelector('base');
        if (!baseTag) {
          baseTag = document.createElement('base');
          document.head.prepend(baseTag);
        }
        baseTag.href = baseHref;
      })();
    </script>

    <link rel="stylesheet" href="css/webapps-unified.css" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PDF Splitter | Monetize Hub Tools</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <script src="js/site-chrome.js" defer></script>
</head>
  <body class="tool-page">
    <header class="site-header">
      <div class="header-top">
        <a class="brand" href="../../../index.html">
          <img src="../../../public/logo.png" alt="Monetize Hub" class="brand-logo" />
          <div class="brand-text">
            <span class="brand-name">Monetize Hub</span>
            <span class="brand-tagline">Launch, host, and grow your webapps</span>
          </div>
        </a>
        <details class="nav-dropdown user-dropdown" open>
          <summary class="nav-link nav-dropdown-toggle">
            <span class="user-label">Account</span>
            <span aria-hidden="true">▾</span>
          </summary>
          <div class="nav-dropdown-menu">
            <a href="../../../login.html" class="dropdown-link">Login</a>
            <a href="../../../register.html" class="dropdown-link">Create Account</a>
            <a href="../../../admin.html" class="dropdown-link">Admin Dashboard</a>
          </div>
        </details>
      </div>
      <nav class="main-nav">
        <a href="../../../index.html" class="nav-link">Home</a>
        <a href="../../../about.html" class="nav-link">About</a>
        <details class="nav-dropdown" open>
          <summary class="nav-link nav-dropdown-toggle">Webapps <span aria-hidden="true">▾</span></summary>
          <div class="nav-dropdown-menu">
            <a href="../../../apps/excel-to-json/index.html" class="dropdown-link">Excel → JSON</a>
            <a href="../../../apps/json-to-excel/wwwroot/index.html" class="dropdown-link">JSON → Excel</a>
            <a href="../../../apps/xml-json-translator/index.html" class="dropdown-link">XML ⇄ JSON Translator</a>
            <a href="../../../apps/yaml-json-converter/index.html" class="dropdown-link">YAML ↔ JSON Converter</a>
            <a href="../../../apps/json-combiner/wwwroot/index.html" class="dropdown-link">JSON Combiner</a>
            <a href="../../../apps/find-and-replace/wwwroot/index.html" class="dropdown-link">Find &amp; Replace</a>
            <a href="../../../apps/csv-xml-converter/index.html" class="dropdown-link">CSV/XML Converter</a>
            <a href="../../../apps/list-comparison/wwwroot/index.html" class="dropdown-link">List Comparison / Diff Checker</a>
            <a href="../../../apps/pdf-splitter/wwwroot/index.html" class="dropdown-link active">PDF Splitter</a>
            <a href="../../../apps/bullet-list-extractor/wwwroot/index.html" class="dropdown-link">Bullet List Extractor</a>
            <a href="../../../apps/powerpoint-to-pdf/wwwroot/index.html" class="dropdown-link">PowerPoint → PDF</a>
            <a href="../../../apps/powerpoint-image-extractor/wwwroot/index.html" class="dropdown-link">PowerPoint Image Extractor</a>
          </div>
        </details>
      </nav>
    </header>

    <main class="tool-shell">
      <div class="app-shell">
      <header class="d-flex align-items-center justify-content-between mb-3">
        <div>
          <p class="badge-pill mb-2">Browser-based, local processing</p>
          <h1 class="page-title mb-1">PDF Splitter</h1>
          <p class="muted mb-0">
            Upload one or more PDFs, set page ranges, or choose chunk sizes to download the split files instantly.
          </p>
        </div>
        <img src="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/1f4da.svg" width="64" height="64" alt="PDFs" />
      </header>

      <div class="card-gradient mb-4">
        <label class="form-label fw-semibold">Select PDF files</label>
        <input class="form-control form-control-lg" type="file" id="pdfFiles" accept="application/pdf" multiple />

        <div class="controls-grid mt-3">
          <div class="control-card">
            <label for="pageRanges" class="form-label">Specific page ranges</label>
            <input
              id="pageRanges"
              type="text"
              class="form-control"
              placeholder="Example: 1-3,5,8-9"
              aria-describedby="rangeHelp"
            />
            <div id="rangeHelp" class="form-text text-secondary">
              Leave blank to use other split settings. Ranges apply to each uploaded file.
            </div>
          </div>
          <div class="control-card">
            <label for="pagesPerFile" class="form-label">Pages per split file</label>
            <input id="pagesPerFile" type="number" min="1" class="form-control" placeholder="e.g., 5" />
            <div class="form-text text-secondary">Creates evenly sized parts when no custom ranges are set.</div>
          </div>
          <div class="control-card">
            <label for="targetSize" class="form-label">Approximate size target (MB)</label>
            <input id="targetSize" type="number" min="1" step="0.1" class="form-control" placeholder="e.g., 2" />
            <div class="form-text text-secondary">Estimates chunk size using the original file size and page count.</div>
          </div>
        </div>

        <div class="d-flex align-items-center gap-3 mt-3 flex-wrap">
          <button id="splitBtn" class="btn btn-primary btn-lg px-4">Split PDFs</button>
          <span id="status" class="muted"></span>
        </div>
        <div id="toast" class="toast mt-3" role="status" style="display: none"></div>
      </div>

      <section aria-live="polite">
        <div class="d-flex align-items-center justify-content-between mb-2">
          <h2 class="h5 mb-0">Split files</h2>
          <small class="muted">New parts appear here as they are generated.</small>
        </div>
        <ul id="results" class="results-list"></ul>
        <p id="emptyState" class="muted">No split files yet. Add a PDF and choose your ranges to get started.</p>
      </section>

      <div class="notice">
        All processing happens inside your browser using <code>pdf-lib</code>. Files never leave your device, so sensitive
        documents stay private.
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.min.js"></script>
    <script>
      const splitBtn = document.getElementById('splitBtn');
      const filesInput = document.getElementById('pdfFiles');
      const pageRangesInput = document.getElementById('pageRanges');
      const pagesPerFileInput = document.getElementById('pagesPerFile');
      const targetSizeInput = document.getElementById('targetSize');
      const resultsList = document.getElementById('results');
      const emptyState = document.getElementById('emptyState');
      const statusEl = document.getElementById('status');
      const toast = document.getElementById('toast');

      let objectUrls = [];

      function showToast(message, isError = false) {
        toast.textContent = message;
        toast.style.display = 'block';
        toast.classList.toggle('error', isError);
        setTimeout(() => {
          toast.style.display = 'none';
        }, 3800);
      }

      function clearOldUrls() {
        objectUrls.forEach((url) => URL.revokeObjectURL(url));
        objectUrls = [];
      }

      function parseRanges(rangeText, totalPages) {
        const cleaned = rangeText.replace(/\s+/g, '');
        if (!cleaned) return [];

        const tokens = cleaned.split(',');
        const ranges = [];

        for (const token of tokens) {
          if (!token) continue;
          const [startRaw, endRaw] = token.split('-');
          const start = Number(startRaw);
          const end = endRaw ? Number(endRaw) : start;

          if (!Number.isInteger(start) || !Number.isInteger(end) || start < 1 || end < 1 || start > totalPages) {
            throw new Error(`Range "${token}" is invalid for a document with ${totalPages} pages.`);
          }

          ranges.push({ start: Math.min(start, end), end: Math.min(Math.max(start, end), totalPages) });
        }

        return ranges;
      }

      function buildAutoRanges(totalPages, pagesPerFile, targetSizeMb, originalSize) {
        if (pagesPerFile) {
          const segments = [];
          for (let start = 1; start <= totalPages; start += pagesPerFile) {
            const end = Math.min(start + pagesPerFile - 1, totalPages);
            segments.push({ start, end });
          }
          return segments;
        }

        if (targetSizeMb && originalSize > 0) {
          const targetBytes = targetSizeMb * 1024 * 1024;
          const avgBytesPerPage = originalSize / totalPages;
          const estimatedPages = Math.max(1, Math.floor(targetBytes / avgBytesPerPage));
          const pagesPerChunk = Math.min(Math.max(1, estimatedPages), totalPages);
          const segments = [];

          for (let start = 1; start <= totalPages; start += pagesPerChunk) {
            const end = Math.min(start + pagesPerChunk - 1, totalPages);
            segments.push({ start, end });
          }

          return segments;
        }

        throw new Error('Choose specific ranges, pages per file, or a size target before splitting.');
      }

      function describeRange(range) {
        return range.start === range.end ? `page ${range.start}` : `pages ${range.start}-${range.end}`;
      }

      async function splitSingleFile(file, rangeText, pagesPerFile, targetSizeMb) {
        const arrayBuffer = await file.arrayBuffer();
        const sourceDoc = await PDFLib.PDFDocument.load(arrayBuffer);
        const totalPages = sourceDoc.getPageCount();

        const ranges = rangeText
          ? parseRanges(rangeText, totalPages)
          : buildAutoRanges(totalPages, pagesPerFile, targetSizeMb, file.size);

        let partIndex = 1;

        for (const range of ranges) {
          const copyIndices = [];
          for (let i = range.start - 1; i <= range.end - 1; i += 1) {
            copyIndices.push(i);
          }

          const partDoc = await PDFLib.PDFDocument.create();
          const copiedPages = await partDoc.copyPages(sourceDoc, copyIndices);
          copiedPages.forEach((page) => partDoc.addPage(page));

          const bytes = await partDoc.save();
          const blob = new Blob([bytes], { type: 'application/pdf' });
          const url = URL.createObjectURL(blob);
          objectUrls.push(url);

          const li = document.createElement('li');
          const label = document.createElement('div');
          label.innerHTML = `<strong>${file.name.replace(/\.pdf$/i, '')}-part-${partIndex}.pdf</strong><br /><small>${describeRange(
            range
          )} · ${(blob.size / (1024 * 1024)).toFixed(2)} MB</small>`;

          const downloadBtn = document.createElement('a');
          downloadBtn.className = 'btn btn-sm btn-outline-light';
          downloadBtn.href = url;
          downloadBtn.download = `${file.name.replace(/\.pdf$/i, '')}-part-${partIndex}.pdf`;
          downloadBtn.textContent = 'Download';

          li.appendChild(label);
          li.appendChild(downloadBtn);
          resultsList.appendChild(li);
          partIndex += 1;
        }
      }

      splitBtn.addEventListener('click', async () => {
        const files = Array.from(filesInput.files || []);
        resultsList.innerHTML = '';
        emptyState.style.display = 'none';
        clearOldUrls();

        if (files.length === 0) {
          showToast('Add at least one PDF to split.', true);
          statusEl.textContent = '';
          emptyState.style.display = 'block';
          return;
        }

        const rangeText = pageRangesInput.value.trim();
        const pagesPerFile = Number(pagesPerFileInput.value) > 0 ? Number(pagesPerFileInput.value) : 0;
        const targetSizeMb = Number(targetSizeInput.value) > 0 ? Number(targetSizeInput.value) : 0;

        statusEl.textContent = 'Splitting PDFs...';
        splitBtn.disabled = true;

        try {
          for (const file of files) {
            await splitSingleFile(file, rangeText, pagesPerFile, targetSizeMb);
          }
          showToast('Finished splitting files!');
          statusEl.textContent = 'Done';
        } catch (err) {
          console.error(err);
          resultsList.innerHTML = '';
          emptyState.style.display = 'block';
          statusEl.textContent = '';
          showToast(err.message || 'Unable to split the selected PDF(s).', true);
        } finally {
          splitBtn.disabled = false;
        }
      });
    </script>
    </main>
  </body>
</html>
