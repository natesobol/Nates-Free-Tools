<!DOCTYPE html>
<html lang="en">
  <head>
    <script id="asset-base-loader">
      (function() {
        const segments = window.location.pathname.split('/').filter(Boolean);
        const repoIndex = segments.indexOf('Nates-Free-Tools');
        const baseHref = repoIndex !== -1 ? '/' + segments.slice(0, repoIndex + 1).join('/') + '/' : '/';
        let baseTag = document.querySelector('base');
        if (!baseTag) {
          baseTag = document.createElement('base');
          document.head.prepend(baseTag);
        }
        baseTag.href = baseHref;
      })();
    </script>

    <link rel="stylesheet" href="css/webapps-unified.css" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PDF Link Extractor | Monetize Hub Tools</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <style>
      .drop-zone {
        border: 2px dashed var(--border-subtle);
        border-radius: 12px;
        padding: 32px;
        background: rgba(255, 255, 255, 0.4);
        transition: border-color 0.2s ease, background 0.2s ease;
      }
      .drop-zone.dragover {
        border-color: var(--primary-color);
        background: rgba(99, 102, 241, 0.06);
      }
      .results-list {
        list-style: none;
        padding: 0;
        margin: 0;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .results-list li {
        padding: 16px;
        border: 1px solid var(--border-subtle);
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.7);
      }
      .stat-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 12px;
        margin: 0;
        padding: 0;
        list-style: none;
      }
      .stat-card {
        border: 1px solid var(--border-subtle);
        border-radius: 12px;
        padding: 12px 14px;
        background: linear-gradient(180deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.75) 100%);
      }
      .badge-pill {
        background: #eef2ff;
        color: #4f46e5;
        border-radius: 999px;
        padding: 6px 12px;
        font-weight: 600;
        font-size: 0.85rem;
      }
    </style>
        <script src="public/js/webapps-menu.js" defer></script>
    <script src="js/site-chrome.js" defer></script>
</head>
  <body class="tool-page">
    <header class="site-header">
      <div class="header-top">
        <a class="brand" href="../../../index.html">
          <img src="../../../public/logo.png" alt="Monetize Hub" class="brand-logo" />
          <div class="brand-text">
            <span class="brand-name">Monetize Hub</span>
            <span class="brand-tagline">Launch, host, and grow your webapps</span>
          </div>
        </a>
        <details class="nav-dropdown user-dropdown" open>
          <summary class="nav-link nav-dropdown-toggle">
            <span class="user-label">Account</span>
            <span aria-hidden="true">▾</span>
          </summary>
          <div class="nav-dropdown-menu">
            <a href="../../../login.html" class="dropdown-link">Login</a>
            <a href="../../../register.html" class="dropdown-link">Create Account</a>
            <a href="../../../admin.html" class="dropdown-link">Admin Dashboard</a>
          </div>
        </details>
      </div>
      <nav class="main-nav">
        <a href="../../../index.html" class="nav-link">Home</a>
        <a href="../../../about.html" class="nav-link">About</a>
        <details class="nav-dropdown" open>

          <summary class="nav-link nav-dropdown-toggle">Webapps <span aria-hidden="true">▾</span></summary>

          <div class="nav-dropdown-menu mega-menu" data-webapps-menu></div>

        </details>
      </nav>
    </header>

    <main class="tool-shell">
      <div class="app-shell">
        <header class="d-flex align-items-center justify-content-between mb-3">
          <div>
            <p class="badge-pill mb-2">Browser-based, local parsing</p>
            <h1 class="page-title mb-1">PDF Link Extractor</h1>
            <p class="muted mb-0">
              Upload one or more PDFs to pull every URL from visible text and link annotations, then export them instantly.
            </p>
          </div>
          <img src="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/1f517.svg" width="64" height="64" alt="Links" />
        </header>

        <div class="card-gradient mb-4">
          <div class="d-flex align-items-start gap-3 flex-wrap">
            <div class="flex-grow-1">
              <label class="form-label fw-semibold">Add PDF files</label>
              <div id="dropZone" class="drop-zone" role="button" tabindex="0" aria-label="Drop PDFs here or use the file picker">
                <p class="mb-2">Drag and drop PDFs here, or</p>
                <input class="form-control" type="file" id="pdfFiles" accept="application/pdf" multiple />
                <small class="text-secondary">Links stay on your device. Processing happens fully in your browser.</small>
              </div>
            </div>
            <div class="control-card" style="min-width: 240px;">
              <label class="form-label">Exports</label>
              <div class="d-flex flex-column gap-2">
                <button id="exportTxt" class="btn btn-outline-secondary" type="button">Download TXT</button>
                <button id="exportCsv" class="btn btn-outline-secondary" type="button">Download CSV</button>
                <button id="exportHtml" class="btn btn-outline-secondary" type="button">Download HTML Index</button>
                <small class="text-secondary">Exports enable once URLs are detected.</small>
              </div>
            </div>
          </div>

          <div class="d-flex align-items-center gap-3 mt-3 flex-wrap">
            <button id="extractBtn" class="btn btn-primary btn-lg px-4" type="button">Extract links</button>
            <span id="status" class="muted"></span>
          </div>
          <div id="toast" class="toast mt-3" role="status" style="display: none"></div>
        </div>

        <section aria-live="polite" class="mb-4">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <h2 class="h5 mb-0">Results</h2>
            <small class="muted">Includes URLs found in text and link annotations.</small>
          </div>
          <ul id="statCards" class="stat-cards"></ul>
          <ul id="results" class="results-list mt-3"></ul>
          <p id="emptyState" class="muted">No links yet. Add your PDFs and click Extract to get started.</p>
        </section>

        <div class="notice">
          All parsing uses <code>pdf.js</code> directly in your browser. Files are never uploaded to the server.
        </div>
      </div>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.2.67/pdf.min.js" integrity="sha512-uOf5EHKkUq9V8rK40MpjVckfn/fxJwqO0pUNz0+D/f+rCckXtHUijVA1hp6t8tBMlSl2J3pP/W8oYeX6mIMX0A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
      pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.2.67/pdf.worker.min.js";

      const fileInput = document.getElementById("pdfFiles");
      const dropZone = document.getElementById("dropZone");
      const extractBtn = document.getElementById("extractBtn");
      const statusEl = document.getElementById("status");
      const resultsEl = document.getElementById("results");
      const emptyState = document.getElementById("emptyState");
      const statCards = document.getElementById("statCards");
      const toast = document.getElementById("toast");
      const exportTxt = document.getElementById("exportTxt");
      const exportCsv = document.getElementById("exportCsv");
      const exportHtml = document.getElementById("exportHtml");

      let selectedFiles = [];
      const findings = new Map();

      function showToast(message, tone = "info") {
        toast.textContent = message;
        toast.style.display = "block";
        toast.className = `toast toast-${tone}`;
        setTimeout(() => (toast.style.display = "none"), 3500);
      }

      function collectFiles(files) {
        if (!files?.length) return;
        selectedFiles = Array.from(files);
        statusEl.textContent = `${selectedFiles.length} file(s) ready.`;
      }

      function setExportsEnabled(enabled) {
        [exportTxt, exportCsv, exportHtml].forEach((btn) => (btn.disabled = !enabled));
      }

      async function extractLinks() {
        if (!selectedFiles.length) {
          showToast("Please choose at least one PDF first.", "danger");
          return;
        }

        findings.clear();
        resultsEl.innerHTML = "";
        statCards.innerHTML = "";
        emptyState.style.display = "block";
        setExportsEnabled(false);
        extractBtn.disabled = true;
        statusEl.textContent = "Parsing PDFs...";

        for (const file of selectedFiles) {
          await processPdf(file);
        }

        renderResults();
        extractBtn.disabled = false;
        statusEl.textContent = "Extraction complete.";
        setExportsEnabled(findings.size > 0);
      }

      async function processPdf(file) {
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
        for (let pageNumber = 1; pageNumber <= pdf.numPages; pageNumber++) {
          const page = await pdf.getPage(pageNumber);
          const text = await page.getTextContent();
          const pageText = text.items.map((item) => item.str).join(" ");
          const textUrls = findUrls(pageText);
          textUrls.forEach((url) => recordFinding(file.name, url, pageNumber, "Text"));

          const annotations = await page.getAnnotations({ intent: "display" });
          annotations
            .filter((ann) => ann.subtype === "Link" && ann.url)
            .forEach((ann) => recordFinding(file.name, ann.url, pageNumber, "Link annotation"));
        }
      }

      function findUrls(text) {
        const urlRegex = /https?:\/\/[^\s<>()"']+/gi;
        const matches = text.match(urlRegex) || [];
        const normalized = matches.map((m) => m.replace(/[,.;)]$/, "")).filter(Boolean);
        return [...new Set(normalized)];
      }

      function recordFinding(fileName, url, page, source) {
        if (!url) return;
        const cleaned = url.trim();
        if (!cleaned) return;
        const key = `${fileName}::${cleaned}`;
        const existing = findings.get(key) || {
          fileName,
          url: cleaned,
          pages: new Set(),
          sources: new Set(),
        };
        existing.pages.add(page);
        existing.sources.add(source);
        findings.set(key, existing);
      }

      function renderResults() {
        resultsEl.innerHTML = "";
        statCards.innerHTML = "";
        if (!findings.size) {
          emptyState.style.display = "block";
          return;
        }

        emptyState.style.display = "none";
        const entries = Array.from(findings.values()).sort((a, b) => a.fileName.localeCompare(b.fileName));

        const totalLinks = entries.length;
        const uniqueFiles = new Set(entries.map((e) => e.fileName)).size;
        const annotationHits = entries.filter((e) => e.sources.has("Link annotation")).length;

        statCards.innerHTML = `
          <li class="stat-card">
            <div class="text-secondary small">Total URLs</div>
            <div class="fw-bold fs-4">${totalLinks}</div>
          </li>
          <li class="stat-card">
            <div class="text-secondary small">Files scanned</div>
            <div class="fw-bold fs-4">${uniqueFiles}</div>
          </li>
          <li class="stat-card">
            <div class="text-secondary small">Link annotations</div>
            <div class="fw-bold fs-4">${annotationHits}</div>
          </li>`;

        for (const entry of entries) {
          const pages = [...entry.pages].sort((a, b) => a - b).join(", ");
          const sources = [...entry.sources].join(", ");
          const item = document.createElement("li");
          item.innerHTML = `
            <div class="d-flex justify-content-between align-items-start gap-2 flex-wrap">
              <div>
                <a href="${entry.url}" target="_blank" rel="noopener" class="fw-semibold">${entry.url}</a>
                <div class="text-secondary small">File: ${entry.fileName}</div>
              </div>
              <div class="text-end small text-secondary">
                <div>Pages: ${pages}</div>
                <div>Sources: ${sources}</div>
              </div>
            </div>`;
          resultsEl.appendChild(item);
        }
      }

      function downloadFile(filename, content) {
        const blob = new Blob([content], { type: "text/plain" });
        const url = URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.href = url;
        link.download = filename;
        link.click();
        URL.revokeObjectURL(url);
      }

      function exportAsTxt() {
        if (!findings.size) return;
        const lines = Array.from(findings.values()).map((entry) => {
          const pages = [...entry.pages].sort((a, b) => a - b).join(", ");
          const sources = [...entry.sources].join(", ");
          return `${entry.fileName}\t${entry.url}\tPages: ${pages}\tSources: ${sources}`;
        });
        downloadFile("pdf-links.txt", lines.join("\n"));
      }

      function exportAsCsv() {
        if (!findings.size) return;
        const headers = ["File", "URL", "Pages", "Sources"];
        const rows = Array.from(findings.values()).map((entry) => {
          const pages = [...entry.pages].sort((a, b) => a - b).join("; ");
          const sources = [...entry.sources].join("; ");
          return [entry.fileName, entry.url, pages, sources]
            .map((value) => `"${value.replace(/"/g, '""')}"`)
            .join(",");
        });
        downloadFile("pdf-links.csv", [headers.join(","), ...rows].join("\n"));
      }

      function exportAsHtml() {
        if (!findings.size) return;
        const items = Array.from(findings.values())
          .map((entry) => {
            const pages = [...entry.pages].sort((a, b) => a - b).join(", ");
            const sources = [...entry.sources].join(", ");
            return `<li><a href="${entry.url}" target="_blank" rel="noopener">${entry.url}</a><br /><small>File: ${entry.fileName} · Pages: ${pages} · Sources: ${sources}</small></li>`;
          })
          .join("\n");
        const html = `<!DOCTYPE html><html><head>
    <script id="asset-base-loader">
      (function() {
        const segments = window.location.pathname.split('/').filter(Boolean);
        const repoIndex = segments.indexOf('Nates-Free-Tools');
        const baseHref = repoIndex !== -1 ? '/' + segments.slice(0, repoIndex + 1).join('/') + '/' : '/';
        let baseTag = document.querySelector('base');
        if (!baseTag) {
          baseTag = document.createElement('base');
          document.head.prepend(baseTag);
        }
        baseTag.href = baseHref;
      })();
    </script>
<meta charset="UTF-8" /><title>PDF Links</title></head><body><h1>Extracted PDF Links</h1><ol>${items}</ol></body></html>`;
        downloadFile("pdf-links.html", html);
      }

      dropZone.addEventListener("dragover", (event) => {
        event.preventDefault();
        dropZone.classList.add("dragover");
      });

      dropZone.addEventListener("dragleave", () => dropZone.classList.remove("dragover"));

      dropZone.addEventListener("drop", (event) => {
        event.preventDefault();
        dropZone.classList.remove("dragover");
        collectFiles(event.dataTransfer.files);
      });

      dropZone.addEventListener("keydown", (event) => {
        if (event.key === "Enter" || event.key === " ") {
          event.preventDefault();
          fileInput.click();
        }
      });

      fileInput.addEventListener("change", (event) => collectFiles(event.target.files));
      extractBtn.addEventListener("click", extractLinks);
      exportTxt.addEventListener("click", exportAsTxt);
      exportCsv.addEventListener("click", exportAsCsv);
      exportHtml.addEventListener("click", exportAsHtml);
      setExportsEnabled(false);
    </script>
  </body>
</html>
