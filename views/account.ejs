<%- include('partials/page-top') %>
<section class="page-section">
  <div class="section-header">
    <div>
      <p class="eyebrow">Account center</p>
      <h1>Manage your profile and access</h1>
      <p class="lede">Update your information, marketing preferences, and see which apps you can use.</p>
    </div>
    <div class="account-summary">
      <p class="label">Signed in as</p>
      <p class="value"><%= email %></p>
      <p class="label">Role</p>
      <p class="value"><%= profile ? profile.role : '' %></p>
    </div>
  </div>

  <form method="POST" action="/account" class="form-grid card">
    <label>
      <span>Full name</span>
      <input type="text" name="fullName" value="<%= profile?.full_name || '' %>" required />
    </label>
    <label class="checkbox">
      <input type="checkbox" name="marketingOptIn" <%= profile?.marketing_opt_in ? 'checked' : '' %> />
      <span>Receive product updates and marketing emails</span>
    </label>
    <button type="submit" class="button primary btn btn-primary btn-modern">Save changes</button>
  </form>

  <div class="card stack">
    <h3>Subscribed apps</h3>
    <% if (!subscriptions || !subscriptions.length) { %>
      <p class="muted">No app subscriptions found for this account.</p>
    <% } else { %>
      <ul class="subscription-list">
        <% subscriptions.forEach((sub) => { %>
          <li class="subscription-item">
            <div>
              <p class="value"><%= sub.app?.name || sub.app?.slug || 'Unknown app' %></p>
              <p class="label">Slug: <%= sub.app?.slug || 'n/a' %></p>
            </div>
            <span class="status-chip <%= sub.is_enabled ? 'chip-success' : 'chip-muted' %>">
              <%= sub.is_enabled ? 'Enabled' : 'Disabled' %>
            </span>
          </li>
        <% }) %>
      </ul>
    <% } %>
  </div>
</section>
<%- include('partials/page-bottom') %>
